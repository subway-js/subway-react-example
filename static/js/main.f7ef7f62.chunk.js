(this["webpackJsonpsubway-react-restaurant"]=this["webpackJsonpsubway-react-restaurant"]||[]).push([[0],{132:function(e,a,n){e.exports=n(256)},256:function(e,a,n){"use strict";n.r(a);var t=n(0),r=n.n(t),l=n(29),o=n.n(l),i=n(261),d=n(270),u=n(16),c=n(30),s="OpenTab",m="PlaceOrder",b="MarkDrinksServed",g="MarkFoodServed",f="CloseTab",p="TabOpened",E="DrinksOrdered",v="FoodOrdered",h="DrinksServed",k="FoodServed",y="TabClosed",O={command:s,handler:function(e,a){return{events:[{id:p,payload:a}]}}},I={command:m,handler:function(e,a){var n=a.tableId,t=a.orderedItems,r=t.food,l=t.drinks;return{events:[{id:E,payload:{tableId:n,drinks:l}},{id:v,payload:{tableId:n,food:r}}]}}},C={command:b,handler:function(e,a){return{events:[{id:h,payload:a}]}},onError:function(e){console.log("# Error sending command:",e)}},w={command:g,handler:function(e,a){return{events:[{id:k,payload:a}]}}},F={command:f,handler:function(e,a){var n=a.table,t=n.id,r=n.servedItemsValue,l=n.tipPercentage,o=n.tip,i=n.bill,d=n.waiter;return{events:[{id:y,payload:{id:a.id,tableId:t,amountPaid:i,orderValue:r,tipPercentage:l,tip:o,waiter:d}}]}}},A={command:p,handler:function(e,a){return{proposal:Object(u.a)({},e,{tables:e.tables.map((function(e){return e.id===a.table&&(e.status="open",e.numberOfPeople=a.numberOfPeople,e.waiter=a.waiter),e}))})}}},P={command:E,handler:function(e,a){var n=a.tableId,t=a.drinks;return{proposal:Object(u.a)({},e,{tables:e.tables.map((function(e){return e.id===n&&(e.status="waitingOrder",e.outstandingDrinks=t),e}))})}}},D={command:v,handler:function(e,a){var n=a.tableId,t=a.food;return{proposal:Object(u.a)({},e,{tables:e.tables.map((function(e){return e.id===n&&(e.status="waitingOrder",e.outstandingFood=t),e}))})}}},T={command:h,handler:function(e,a){var n=a.servedItems,t=a.tableId,r=e.tables.filter((function(e){return e.id===t}))[0],l=n.map((function(e){return e.menuNumber})),o=r.outstandingDrinks?r.outstandingDrinks.filter((function(e){return!l.includes(e.menuNumber)})):[],i=(r.outstandingDrinks?r.outstandingDrinks.filter((function(e){return l.includes(e.menuNumber)})):[]).reduce((function(e,a){return e+a.price}),0);return{proposal:Object(u.a)({},e,{tables:e.tables.map((function(e){if(e.id===t){var a=Object(u.a)({},r);return a.outstandingDrinks=o,a.servedItemsValue=(a.servedItemsValue||0)+i,0===a.outstandingFood.length&&0===a.outstandingDrinks.length&&(a.status="readyToPay",a.tipPercentage=12,a.tip=a.servedItemsValue*(a.tipPercentage/100),a.bill=a.servedItemsValue+a.tip),a}return e}))})}}},j={command:k,handler:function(e,a){var n=a.servedItems,t=a.tableId,r=e.tables.filter((function(e){return e.id===t}))[0],l=n.map((function(e){return e.menuNumber})),o=r.outstandingFood?r.outstandingFood.filter((function(e){return!l.includes(e.menuNumber)})):[],i=(r.outstandingFood?r.outstandingFood.filter((function(e){return l.includes(e.menuNumber)})):[]).reduce((function(e,a){return e+a.price}),0);return{proposal:Object(u.a)({},e,{tables:e.tables.map((function(e){if(e.id===t){var a=Object(u.a)({},r);return a.outstandingFood=o,a.servedItemsValue=(a.servedItemsValue||0)+i,0===a.outstandingFood.length&&0===a.outstandingDrinks.length&&(a.status="readyToPay",a.tipPercentage=12,a.tip=a.servedItemsValue*(a.tipPercentage/100),a.bill=a.servedItemsValue+a.tip),a}return e}))})}}},N={command:y,handler:function(e,a){var n=a.tableId;return{proposal:Object(u.a)({},e,{tables:e.tables.map((function(e){return e.id===n?{id:n,label:e.label,status:"available"}:e}))})}}},S=n(25),H=n(265),x=window.Subway,V=function(e,a){return e=Math.ceil(e),a=Math.floor(a),Math.floor(Math.random()*(a-e+1))+e},M=n(57),z=n(26),R=n(268),B=n(260),L=n(269),W=n(263),_=n(267);function J(e){var a=e.data,n=e.onSitCustomers,t=e.onPay;return a?r.a.createElement(H.a,{key:a.id,color:"green",style:{minHeight:250}},r.a.createElement(H.a.Content,null,r.a.createElement(M.a,{as:"span",color:"green",ribbon:!0},a.label),r.a.createElement(H.a.Meta,null,"available"===a.status?"This table is free":r.a.createElement("span",null,Array(a.numberOfPeople).fill(1).map((function(e,a){return r.a.createElement(z.a,{key:a,color:"green",name:"user"})})))),r.a.createElement(H.a.Description,null,"available"===a.status&&r.a.createElement("div",{className:"ui center aligned"},r.a.createElement("br",null),r.a.createElement(R.a,{color:"grey",size:"mini"},r.a.createElement(R.a.Value,null,r.a.createElement(z.a,{name:"food"}))),r.a.createElement("br",null)),"open"===a.status&&r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement(B.a,{active:!0,inline:"centered"}),r.a.createElement("br",null)),"waitingOrder"===a.status&&r.a.createElement(L.a,{divided:"vertically"},r.a.createElement(L.a.Row,{columns:2},r.a.createElement(L.a.Column,null,r.a.createElement(W.a,{size:"mini"},a.outstandingDrinks&&a.outstandingDrinks.length>0&&r.a.createElement(W.a.Item,null,r.a.createElement(W.a.Header,null,"Drinks:")),a.outstandingDrinks&&a.outstandingDrinks.map((function(e,n){return r.a.createElement(W.a.Item,{key:"".concat(a.id,"_").concat(n,"_").concat(e.menuNumber)},r.a.createElement(z.a,{loading:!0,name:"spinner"})," ",e.label)})))),r.a.createElement(L.a.Column,null,r.a.createElement(W.a,{size:"mini"},a.outstandingFood&&a.outstandingFood.length>0&&r.a.createElement(W.a.Item,null,r.a.createElement(W.a.Header,null,"Food:")),a.outstandingFood&&a.outstandingFood.map((function(e,n){return r.a.createElement(W.a.Item,{key:"".concat(a.id,"_").concat(n,"_").concat(e.menuNumber)},r.a.createElement(z.a,{loading:!0,name:"spinner"})," ",e.label)})))))),"readyToPay"===a.status&&r.a.createElement("div",{className:"ui center aligned"},r.a.createElement("br",null),r.a.createElement(R.a,{color:"green",size:"tiny"},r.a.createElement(R.a.Label,null,a.servedItemsValue.toFixed(2)," \u20ac + ",a.tipPercentage,"% tip"),r.a.createElement(R.a.Label,null,"="),r.a.createElement(R.a.Value,null,a.bill.toFixed(2)," \u20ac")),r.a.createElement("br",null)))),r.a.createElement(H.a.Content,{extra:!0},"open"===a.status&&r.a.createElement("p",null,"Customers choosing food & drinks..."),"available"===a.status&&r.a.createElement("div",{className:"ui two buttons"},r.a.createElement(_.a,{basic:!0,color:"green",onClick:function(){return n(a)}},"Sit customers")),"waitingOrder"===a.status&&r.a.createElement("p",null,"Cooking and delivering orders..."),"readyToPay"===a.status&&r.a.createElement("div",{className:"ui two buttons"},r.a.createElement(_.a,{color:"green",onClick:function(){return t(a)}},"Pay & free table")))):null}function K(){var e=Object(t.useState)(null),a=Object(S.a)(e,2),n=a[0],l=a[1];Object(t.useEffect)((function(){var e=x.selectAggregate(G),a=e.observeState({next:function(e){var a=e.nextState;console.log(" > TAB new state:",a);var n=a.tables;l(n)}}).currentState;console.log(" > TAB initial state:",a),l(a.tables),i(e)}),[]);var o=function(e){e&&e.forEach((function(e){var a,n,t;"open"===e.status&&(a=e.id,t=e.numberOfPeople,n={food:Array(t).fill(1).map((function(e){return c.a.foodMenu[V(0,c.a.foodMenu.length-1)]})),drinks:Array(t).fill(1).map((function(e){return c.a.drinksMenu[V(0,c.a.drinksMenu.length-1)]}))},x.selectAggregate(G).sendCommand(m,{id:0,tableId:a,orderedItems:n}))}))},i=function(e){var a=x.selectAggregate("KitchenAggregate");a.spy("DrinksPrepared",{next:function(e){var a=e.table;e.drinks.forEach((function(e){setTimeout((function(){!function(e,a){x.selectAggregate(G).sendCommand(b,{id:0,tableId:e,servedItems:a})}(a,[e])}),V(1e3,2e3))}))}}),a.spy("FoodPrepared",{next:function(e){var a=e.table;e.food.forEach((function(e){setTimeout((function(){!function(e,a){x.selectAggregate(G).sendCommand(g,{id:0,tableId:e,servedItems:a})}(a,[e])}),V(1e3,2e3))}))}})},d=function(e){var a,t,r,l=e.id;a=l,t=V(2,6),r=1,x.selectAggregate(G).sendCommand(s,{id:0,table:a,numberOfPeople:t,waiter:r}),setTimeout((function(){return o(n)}),1e3)},u=function(e){!function(e){x.selectAggregate(G).sendCommand(f,{id:"BILL_".concat(Date.now()),table:e})}(e)};return r.a.createElement(H.a.Group,{itemsPerRow:3},n&&n.map((function(e){return r.a.createElement(J,{onSitCustomers:d,onPay:u,key:e.id,data:e})})))}var G="TabAggregate",Z={tables:c.b.map((function(e){return Object(u.a)({},e,{status:"available"})}))},$=[O,I,C,w,F],q=[A,P,D,T,j,N],Q="AddDrinkOrder",U="AddFoodOrder",X="PrepareDrinks",Y="PrepareFood",ee="DrinksOrderAdded",ae="FoodOrderAdded",ne="DrinksPrepared",te="FoodPrepared",re={command:Q,handler:function(e,a){return{events:[{id:ee,payload:a}]}}},le={command:U,handler:function(e,a){return{events:[{id:ae,payload:a}]}}},oe={command:X,handler:function(e,a){return{events:[{id:ne,payload:a}]}}},ie={command:Y,handler:function(e,a){return{events:[{id:te,payload:a}]}}},de={command:ee,handler:function(e,a){return{proposal:Object(u.a)({},e,{orders:e.orders.concat(a)})}}},ue={command:ae,handler:function(e,a){return{proposal:Object(u.a)({},e,{orders:e.orders.concat(a)})}}},ce={command:ne,handler:function(e,a){return{proposal:Object(u.a)({},e,{orders:e.orders.filter((function(e){return e.id!==a.id}))})}}},se={command:te,handler:function(e,a){return{proposal:Object(u.a)({},e,{orders:e.orders.filter((function(e){return e.id!==a.id}))})}}},me=n(266);function be(e){var a=e.orderId,n=e.tableId,t=e.drinks,l=void 0===t?null:t,o=e.food,i=void 0===o?null:o,d=e.onOrderReady;return r.a.createElement(H.a,{key:a,raised:!0},r.a.createElement(H.a.Content,null,r.a.createElement(M.a,{as:"span",tag:!0,color:"brown"},r.a.createElement(z.a,{key:a,name:l?"glass martini":"food"}),"for table ",n),r.a.createElement(W.a,{bulleted:!0,size:"mini"},l&&l.map((function(e,a){return r.a.createElement(W.a.Item,{key:a},e.label)})),i&&i.map((function(e,a){return r.a.createElement(W.a.Item,{key:a},e.label)})))),r.a.createElement(H.a.Content,{extra:!0},r.a.createElement(_.a,{size:"mini",fluid:!0,basic:!0,color:"brown",onClick:function(){return d(a,n,l,i)}},"Mark as ready")))}function ge(){var e=Object(t.useState)(null),a=Object(S.a)(e,2),n=a[0],l=a[1];Object(t.useEffect)((function(){var e=x.selectAggregate("TabAggregate").spy("DrinksOrdered",{next:function(e){!function(e,a){x.selectAggregate(fe).sendCommand(Q,{id:"D".concat(Date.now()),table:e,drinks:a})}(e.tableId,e.drinks)}}),a=x.selectAggregate("TabAggregate").spy("FoodOrdered",{next:function(e){!function(e,a){x.selectAggregate(fe).sendCommand(U,{id:"F".concat(Date.now()),table:e,food:a})}(e.tableId,e.food)}}),n=x.selectAggregate(fe).observeState({next:function(e){var a=e.nextState.orders;l(a)}}).currentState;return l(n.orders),function(){e(),a()}}),[]);var o=function(e,a,n,t){n&&function(e,a,n){x.selectAggregate(fe).sendCommand(X,{id:e,table:a,drinks:n})}(e,a,n),t&&function(e,a,n){x.selectAggregate(fe).sendCommand(Y,{id:e,table:a,food:n})}(e,a,t)};return r.a.createElement(r.a.Fragment,null,!n||0===n.length&&r.a.createElement(i.a,null,r.a.createElement(me.a,{color:"brown",size:"mini",icon:!0},r.a.createElement(z.a,{name:"circle notched",loading:!0}),r.a.createElement(me.a.Content,null,r.a.createElement(me.a.Header,null,"Waiting"),"There are no pending orders to fulfill..."))),n&&r.a.createElement(H.a.Group,{itemsPerRow:3},n.map((function(e,a){var n=e.id,t=e.table,l=e.drinks,i=e.food;return r.a.createElement(be,{key:a,orderId:n,tableId:t,drinks:l,food:i,onOrderReady:o})}))))}var fe="KitchenAggregate",pe=[re,le,oe,ie],Ee=[de,ue,ce,se],ve=n(123),he=n(264);function ke(){var e=Object(t.useState)([]),a=Object(S.a)(e,2),n=a[0],l=a[1],o=Object(t.useState)(0),d=Object(S.a)(o,2),u=d[0],c=d[1],s=Object(t.useState)(0),m=Object(S.a)(s,2),b=m[0],g=m[1],f=function(e){return e.toFixed(2)+"\u20ac"};return Object(t.useEffect)((function(){var e=x.selectAggregate("TabAggregate").spy("TabClosed",{next:function(e){var a=e.id,n=e.tableId,t=e.orderValue,r=e.amountPaid,o=e.tip;l((function(e){return[].concat(Object(ve.a)(e),[{id:a,tableId:n,orderValue:t,amountPaid:r,tip:o}])})),c((function(e){return e+o})),g((function(e){return e+t}))}});return function(){e()}}),[]),r.a.createElement(r.a.Fragment,null,!n||0===n.length&&r.a.createElement(i.a,null,r.a.createElement(me.a,{color:"blue",size:"mini",icon:!0},r.a.createElement(z.a,{name:"circle notched",loading:!0}),r.a.createElement(me.a.Content,null,r.a.createElement(me.a.Header,null,"Waiting"),"No bills processed yet..."))),n&&n.length>0&&r.a.createElement(he.a,{color:"blue",fixed:!0,singleLine:!0,inverted:!0,size:"small"},r.a.createElement(he.a.Header,null,r.a.createElement(he.a.Row,null,r.a.createElement(he.a.HeaderCell,null,"Table ID"),r.a.createElement(he.a.HeaderCell,null,"Amount Paid"),r.a.createElement(he.a.HeaderCell,null,"Order Value"),r.a.createElement(he.a.HeaderCell,null,"Tip"))),r.a.createElement(he.a.Body,null,n&&n.map((function(e,a){var n=e.id,t=e.tableId,l=e.orderValue,o=e.amountPaid,i=e.tip;return r.a.createElement(he.a.Row,{key:n},r.a.createElement(he.a.Cell,null,t),r.a.createElement(he.a.Cell,null,f(o)),r.a.createElement(he.a.Cell,null,f(l)),r.a.createElement(he.a.Cell,null,f(i)))}))),r.a.createElement(he.a.Footer,null,r.a.createElement(he.a.Row,null,r.a.createElement(he.a.HeaderCell,null),r.a.createElement(he.a.HeaderCell,null),r.a.createElement(he.a.HeaderCell,null,"Total paid: ",r.a.createElement("b",null,f(b))),r.a.createElement(he.a.HeaderCell,null,"Total tips: ",r.a.createElement("b",null,f(u)))))),r.a.createElement("br",null))}var ye=function(){return r.a.createElement(i.a,null,r.a.createElement("br",null),r.a.createElement(d.a,{color:"green",as:"h4",dividing:!0},"Tables"),r.a.createElement(K,null),r.a.createElement(d.a,{color:"brown",as:"h4",dividing:!0},"Kitchen"),r.a.createElement(ge,null),r.a.createElement(d.a,{color:"blue",as:"h4",dividing:!0},"Billing"),r.a.createElement(ke,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Oe=function(e,a,n){a.forEach((function(a){var n=a.command,t=a.handler,r=a.onError,l=void 0===r?null:r;e.setCommandHandler(n,t,l)})),n.forEach((function(a){var n=a.command,t=a.handler,r=a.onError,l=void 0===r?null:r;e.setEventHandler(n,t,l)}))},Ie=x.createAggregate(G,Z),Ce=x.createAggregate(fe,{orders:[]});Oe(Ie,$,q),Oe(Ce,pe,Ee),o.a.render(r.a.createElement(ye,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},30:function(e){e.exports=JSON.parse('{"b":[{"id":"T001","label":"T1"},{"id":"T002","label":"T2"},{"id":"T003","label":"T3"}],"a":{"drinksMenu":[{"id":"D001","menuNumber":101,"label":"Still water glass","price":2},{"id":"D002","menuNumber":102,"label":"Coke Zero glass","price":4},{"id":"D003","menuNumber":103,"label":"White wine glass","price":7},{"id":"D004","menuNumber":104,"label":"Red wine glass","price":7.5}],"foodMenu":[{"id":"F001","menuNumber":201,"label":"Hamburger & Chips","price":9.9},{"id":"F002","menuNumber":202,"label":"Chicken katsu curry","price":9.9},{"id":"F003","menuNumber":203,"label":"House pizza ","price":10.5},{"id":"F004","menuNumber":204,"label":"Cesar salad","price":7.4}]}}')}},[[132,1,2]]]);
//# sourceMappingURL=main.f7ef7f62.chunk.js.map